<?xml version = "1.0" encoding = "UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace = "Post">

   <insert id = "insert" parameterType = "Post" useGeneratedKeys="true" keyProperty="role_id" keyColumn="role_id">
      	INSERT INTO posts (POST ID, THREAD, AUTHOR, TIMESTAMP, TITLE, TEXT, RATING, HISTORY) 
      	VALUES (#{post id}, #{thread}, #{author}, #{timestamp}, #{title}, #{text}, #{rating}, #{history});
	</insert> 
	
	<update id = "update" parameterType = "Post">
    	UPDATE posts SET THREAD = #{thread}, AUTHOR = #{author}, TIMESTAMP = #{timestamp}, 
    	TITLE = #{title}, TEXT = #{text}, RATING = #{rating}, HISTORY = #{history} 
    	WHERE POST ID = #{post id}; 
	</update>
	
    <delete id = "delete" parameterType = "long">
    	DELETE FROM posts WHERE post_id = #{post_id}
    </delete>
    
    <select id="get" parameterType = "long" resultMap="postMap">
    	SELECT * FROM posts where POST_ID = #{POST_ID};
	</select>

    <select id="getThreadPosts" parameterType = "int" resultMap="postMap">
    	SELECT * FROM posts WHERE thread = #{thread} ORDER BY timestamp;
	</select>

	<select id="getAll" resultMap="postMap">
    	SELECT * FROM posts ORDER BY post_id ASC;
	</select>
    	
	<resultMap id = "postMap" type = "Post">
		<result property = "post_id" column = "POST_ID"/>
		<result property = "thread" column = "THREAD"/>
		<result property = "author" column = "AUTHOR"/>
		<result property = "timestamp" column = "TIMESTAMP"/>
		<result property = "title" column = "TITLE"/>
		<result property = "text" column = "TEXT"/>
		<result property = "rating" column = "RATING" javaType="org.postgresql.util.PGobject" typeHandler="handlers.PGObjectTypeHandler"/>
		<result property = "history" column = "HISTORY" javaType="org.postgresql.util.PGobject" typeHandler="handlers.PGObjectTypeHandler"/>		
	</resultMap>
	
</mapper>